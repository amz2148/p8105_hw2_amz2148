---
title: "p8105_hw2_amz2148"
output: github_document
---

Homework 2

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) #shows all code chunks
```

# Problem 0

```{r load_libraries}
library(tidyverse) #loads tidyverse package
library(readxl) #loads readxl package
```

# Problem 1


# Problem 2

First we read and clean the data from the Mr. Trash Wheel sheet under the following specifications:

* specifying the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
* using reasonable variable names
* omitting rows that do not include dumpster-specific data
* rounding the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)
* adding an additional variable to mark source of data (Mr. vs. Professor sheet)

```{r mr}
mr_trashwheel = 
  read_excel("data/Trash Wheel Collection Data.xlsx", range = "Mr. Trash Wheel!A2:N549") %>% #reads in only desired section and sheet from excel document
  janitor::clean_names()  %>% #cleans variable names
  drop_na(dumpster) %>% #removes rows with missing values for "dumpster" variable
  mutate(sports_balls = as.integer(sports_balls)) %>% #makes "sports_balls" variable an integer
  mutate(machine = "mister") %>% #creates new variable to identify sheet/source of data 
  mutate(year = as.double(year)) #converts character year variable to double
```

Then, we import, clean, and organize the data from the Professor Trash Wheel sheet.

```{r professor}
prof_trashwheel = 
  read_excel("data/Trash Wheel Collection Data.xlsx", range = "Professor Trash Wheel!A2:M96") %>% #reads in only desired section and sheet from excel document
  janitor::clean_names()  %>% #cleans variable names
  drop_na(dumpster) %>% #removes rows with missing values for "dumpster" variable
  mutate(machine = "professor") #creates new variable to identify sheet/source of data 
```

Finally, we combine the Mr. Trash Wheel and Professor Trash Wheel datasets to produce a single tidy dataset.

```{r bind}
trashwheel_tidy = 
  bind_rows(mr_trashwheel, prof_trashwheel) %>% #combines two datasets into one
  janitor::clean_names() %>% #cleans variable names
  select(machine, dumpster, everything()) %>% #reorders columns
  arrange(machine, dumpster) #sorts data by machine name and dumpster number
```

In the resulting dataset, there are ``r nrow(trashwheel_tidy)`` rows (observations) of which ``r nrow(subset(trashwheel_tidy,machine == "mister"))`` observations are from the Mr. Trashwheel dataset and ``r nrow(subset(trashwheel_tidy,machine == "professor"))`` observations are from the Professor Trashwheel dataset. The combined dataset has ``r ncol(trashwheel_tidy)`` variables of which one is new: ``machine`` which identifies which dataset the observation is from. Other important variables include ``date``, ``dumpster``, ``weight_tons``, ``volume_cubic_yards``, and ``homes_powered``. The total weight of trash collected by Professor Trashwheel was ``r sum(trashwheel_tidy[trashwheel_tidy$machine == "professor",]$weight_tons)`` tons. The total number of sports balls collected by Mr. Trash Wheel in 2020 was ``r sum(trashwheel_tidy[trashwheel_tidy$machine == "mister" & trashwheel_tidy$year == "2020",]$sports_balls)`` balls.


# Problem 3

First, we clean the data from the pols-month.csv file. We use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.

```{r pols_month}
pols_month = 
  read_csv(file = "data/fivethirtyeight_datasets/pols-month.csv") %>% #reads in csv file
  janitor::clean_names() %>% #cleans variable names
  separate(mon, into = c("year", "month", "day"), sep = '-') %>% #separates mon variable into year, month, day variables
  mutate(month = as.numeric(month), year = as.numeric(year), day = as.numeric(day)) %>% #converts new variables from character to numeric
  mutate(month = month.abb[month]) %>% #replaces month number with name
  mutate(month = factor(month, levels = month.abb)) %>% #converts month name to factor variable
  mutate(president = case_when(prez_dem == 1 ~ "dem", 
    prez_dem != 1 ~ "gop")) %>% #creates new president variable
  select(-prez_dem, -prez_gop, -day) %>% #removes prez_dem, prez_gap, and day variables
  arrange(year, month) #sorts data by year and month
```

Second, we clean the data in snp.csv using a similar process. For consistency across datasets, we arrange the data according to year and month, and organize so that year and month are the leading columns.

```{r snp}
snp = 
  read_csv(file = "data/fivethirtyeight_datasets/snp.csv") %>% #reads in csv file
  janitor::clean_names() %>% #cleans variable names
  separate(date, into = c("month", "day", "year"), sep = '/') %>% 
  mutate(year = ifelse(year > 15, paste("19",year, sep = ""), paste("20",year, sep = ""))) %>% 
  mutate(month = as.numeric(month), year = as.numeric(year)) %>% #converts month and year variables from character to numeric
  mutate(month = month.abb[month]) %>% #replaces month number with name
  mutate(month = factor(month, levels = month.abb)) %>% #converts month name to factor variable
  select(-day) %>% #removes day variable
  select(year, month, everything()) %>% #reorders columns
  arrange(year, month) #sorts data by year and month
```

Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r unemployment}
unemployment = 
  read_csv(file = "data/fivethirtyeight_datasets/unemployment.csv") %>% #reads in csv file
  rename(year = Year) %>% #changes case of year variable to lowercase (keeping months uppercase for later ease of merging with other files)
  pivot_longer(
    Jan:Dec,
    names_to = "month", 
    values_to = "unemployment_rate") %>% 
  mutate(month = factor(month, levels = month.abb)) #converts month name to factor variable
```

Finally, we join the datasets by merging snp into pols, then merging unemployment into the result.

```{r join}
pols_snp = left_join(pols_month, snp, by = c("year", "month")) #left join adds snp data into pols_month dataset

pols_snp_unemp = left_join(pols_snp, unemployment, by = c("year", "month")) #left join adds unemployment data into pols_snp dataset
```

The ``pols_month`` dataset included ``r nrow(pols_month)`` rows (observations) and ``r ncol(pols_month)`` columns (variables) including ``r names(pols_month)``. The data begins in January 1947 and ends in June 2015. It describes the number of republican and democrat governors, senators, and republicans and the party of the president.

The ``snp`` dataset included ``r nrow(snp)`` rows (observations) and ``r ncol(snp)`` columns (variables) including ``r names(snp)``. The data begins in January 1950 and ends in July 2015. It describes the closing values of the S&P stock index from each associated date.

The ``unemployment`` dataset included ``r nrow(unemployment)`` rows (observations) and ``r ncol(unemployment)`` columns (variables) including ``r names(unemployment)``. The data begins in January 1948 and ends in December 2015. It describes the percentage of unemployment from each associated date.

The ``pols_snp_unemp`` dataset included ``r nrow(pols_snp_unemp)`` rows (observations) and ``r ncol(pols_snp_unemp)`` columns (variables) including ``r names(pols_snp_unemp)``. The dataset overall starts in January 1947 and ends in June 2015 as we created it by left_joining files to the ``pols_month`` dataset, whose range is carried over to the merged dataset. However, observations originally from the ``snp`` dataset only start in January 1950 in the merged dataset and observations originally from the ``unemployment`` dataset only start in January 1950 in the merged dataset.
